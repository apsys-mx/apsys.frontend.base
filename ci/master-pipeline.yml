trigger:
    - master

pr: none

variables:
    - name: projectName
      value: 'apsys.frontend.base.turkey'
    - name: packageSuffix
      value: ''
    - name: buildScript
      value: 'build'

pool:
    name: 'Azure Pipelines'
    vmImage: 'windows-latest'

jobs:
  - job: BuildTestsPack
    displayName: Build, test and pack
    steps:
    - checkout: self
      fetchDepth: 0
    - task: NodeTool@0
      displayName: 'Install Node.js'
      inputs:
          versionSpec: '18.x'
    - script: npm install
      displayName: 'Install packages'
    - task: SonarCloudPrepare@1
      inputs:
        SonarCloud: 'SonarCloud Service'
        organization: 'apsys-dev'
        scannerMode: 'CLI'
        configMode: 'manual'
        cliProjectKey: 'apsys-dev_apsys.frontend.base.turkey'
        cliProjectName: 'apsys.frontend.base.turkey'
        cliSources: '.'
        extraProperties: |
          # Additional properties that will be passed to the scanner, 
          sonar.scanner.metadataFilePath=$(Agent.TempDirectory)/sonar/$(Build.BuildNumber)/test/report-task.txt
    - script: npm run build
    - task: SonarCloudAnalyze@1
      inputs:
        jdkversion: 'JAVA_HOME_11_X64'
    - task: SonarCloudPublish@1
      inputs:
        pollingTimeoutSec: '300'    
    - task: sonarcloud-buildbreaker@2
      inputs:
        SonarCloud: 'SonarCloud Service'
        organization: 'apsys-dev'